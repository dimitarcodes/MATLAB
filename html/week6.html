
<!DOCTYPE html
	PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
--><title>Assignment 6</title><meta name="generator" content="MATLAB 9.9"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2021-02-28"><meta name="DC.source" content="ex6_6.m"><style type="text/css">
	html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1; width:95%;}}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

	html { min-height:100%; margin-bottom:1px; }
	html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
	html body td { vertical-align:top; text-align:left; }

	h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
	h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
	h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

	a { color:#005fce; text-decoration:none; }
	a:hover { color:#005fce; text-decoration:underline; }
	a:visited { color:#004aa0; text-decoration:none; }

	p { font-size: 1.4em; padding:0px; margin:0px 0px 20px; }
	img { padding:0px; display: block; margin: 0px auto 0px; border:none; width:80%;}
	p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

	ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
	ul li { padding:0px; margin:0px 0px 7px 0px; }
	ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
	ul li ol li { list-style:decimal; }
	ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
	ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
	ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
	ol li ol li { list-style-type:lower-alpha; }
	ol li ul { padding-top:7px; }
	ol li ul li { list-style:square; }

	.content { font-size:1.2em; line-height:140%; padding: 20px; }

	pre, code { font-size:12px; background:#f7f7f7;  padding: 10px; border: 1px solid #d3d3d3}
	tt { font-size: 1.2em; }
	pre { margin:0px 0px 20px; }
	pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
	pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
	pre.error { color:red; }

	@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

	span.keyword { color:#0000FF }
	span.comment { color:#228B22 }
	span.string { color:#A020F0 }
	span.untermstring { color:#B20000 }
	span.syscmd { color:#B28C00 }
	span.typesection { color:#A0522D }

	.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
	.footer p { margin:0px; }
	.footer a { color:#878787; }
	.footer a:hover { color:#878787; text-decoration:underline; }
	.footer a:visited { color:#878787; }

	table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
	table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }
	}
	p {
		font-size:1.2em;
	}
	ul, li{
		font-size:1.2em;
	}

</style></head><body><div class="content">
	<h1>Assignment 6 - Dimitar Dimitrov - s1018291</h1>
	
	<h1>8.3 - 1/f noise </h1>

	<h2 id="1">8.3 - 1</h2><pre class="codeinput">load(<span class="string">'tfr-data.mat'</span>);
</pre><h2 id="2">8.3 - 2 - CODE</h2><pre class="codeinput">freq = 1/(time(2)-time(1));
</pre><h2 id="3">8.3 - 2 - ANSWER</h2><p>the sampling frequency is 300hz</p><h2 id="4">8.3 - 3</h2><pre class="codeinput">dfft = fft(data,[], 2);
</pre><h2 id="5">8.3 - 4</h2><pre class="codeinput">n=length(dfft);
T = n/freq;
df= 1/T;
f = 0:df:(freq-df); <span class="comment">% frequency range</span>
n=length(dfft);
n_cutoff = floor(n/2);
range = f(1:n_cutoff); <span class="comment">% cut off the data at nyquist frequency</span>
</pre><h2 id="6">8.3 - 4 ANSWER</h2><p>The associated frequency range is 300hz, nyquist frequency is then 150hz</p><h2 id="7">8.3 - 5</h2><pre class="codeinput">amplitude = abs(dfft)/n;
amplitude = 2 * amplitude(:,1:n_cutoff);
amplitude(:,1) = amplitude(:,1)/2;
</pre><h2 id="8">8.3 - 6</h2><pre class="codeinput">amp_mean = mean(amplitude);
plot(range, amp_mean);
xlabel(<span class="string">'Frequency (Hz)'</span>);
ylabel(<span class="string">'Amplitude'</span>);
title(<span class="string">'frequency-content average accross all trials'</span>);
set(gcf, <span class="string">'Position'</span>, [10,10,600,600]);
</pre><img vspace="5" hspace="5" src="ex8_3_01.png" alt=""> <h2 id="9">8.3 - 7</h2><pre class="codeinput">new_amp_mean = amp_mean.*range;
plot(range, new_amp_mean);
xlabel(<span class="string">'Frequency (Hz)'</span>);
ylabel(<span class="string">'Amplitude (1/f corrected)'</span>);
title(<span class="string">'frequency-content average accross all trials'</span>);
set(gcf, <span class="string">'Position'</span>, [10,10,600,600]);
</pre><img vspace="5" hspace="5" src="ex8_3_02.png" alt=""><h2 id="10">8.3 - 7 - ANSWER</h2><p>the noise at the beginning of the spectrum seems to be gone, the rest of the graph is rescaled so now the highest peak is at 50hz</p> <h2 id="10">8.3 - 8</h2><p>the 50hz frequency occurs most frequently because of the power outlet</p><h2 id="11">8.3 - 9</h2><p>activity seems to occur in the bandwidth 0 to 80 but that seems to be comprised of 3 main bandwidths - 0 to 80 with moderate amplitude, 0-40 with a huge peak in the middle, and the spike at 50hz</p>
	
	<h1>8.4 - slice fft</h1>

	<h2 id="1">8.4</h2><pre class="codeinput">load(<span class="string">'tfr-data.mat'</span>);
freq = 1/(time(2)-time(1));
</pre><h2 id="2">8.4 - 1</h2><pre class="codeinput">s_begin = 1;
s_end = 100;
</pre><h2 id="3">8.4 - 2</h2><pre class="codeinput">slice = data(:,s_begin:s_end);
</pre><h2 id="4">8.4 - 3</h2><pre class="codeinput">[range, amplitude] = fourier_transform(freq, slice);
</pre><h2 id="5">8.4 - 4</h2><pre class="codeinput">subplot(121);
amp_mean = mean(amplitude);
denoised = amp_mean.*range;
plot(range, denoised);
xlabel(<span class="string">'Frequency (Hz)'</span>);
ylabel(<span class="string">'Amplitude (1/f corrected)'</span>);
title([{<span class="string">'frequency-content average accross'</span>},
    {<span class="string">'slices (1:100) from all trials'</span>}]);
set(gcf, <span class="string">'Position'</span>, [10,10,1100,400]);
</pre><img vspace="5" hspace="5" src="ex8_4_01.png" alt=""> <h2 id="6">8.4 - 5</h2><pre class="codeinput">subplot(122)
s_begin = 801;
s_end = 900;
slice = data(:,s_begin:s_end);
[range, amplitude] = fourier_transform(freq, slice);
amp_mean = mean(amplitude);
denoised = amp_mean.*range;
plot(range, denoised);
xlabel(<span class="string">'Frequency (Hz)'</span>);
ylabel(<span class="string">'Amplitude (1/f corrected)'</span>);
title([{<span class="string">'frequency-content average accross'</span>},
    {<span class="string">'slices (801:900) from all trials'</span>}]);
set(gcf, <span class="string">'Position'</span>, [10,10,1100,400]);
</pre><img vspace="5" hspace="5" src="ex8_4_02.png" alt=""> <h2 id="7">8.4 - 5 ANSWER</h2><p>it belongs to timeslot starting at 1.667 seconds and ending at 1.9967 seconds</p><h2 id="8">8.4 - 6</h2><p>the shape is generally the same, the (801-900) slice exhibits slightly higher amplitude values</p><h2 id="9">8.4 - 7</h2><pre class="codeinput">[v, idx] = nearest_value(range, 29);
amp_twni = amp_mean(idx);
</pre><h2 id="10">8.4 - 7 ANSWER</h2><p>the mean amplitude at frequency of 29Hz is 4.1526e-14 (note that this is for the window slice from samples 801 to 900)</p>
	
	<h1>8.5 get_single_amplitude</h1>

	<pre class="codeinput"><span class="keyword">function</span> [amplitude] = get_single_amplitude(data, fs, s_begin, s_end, foi)
<span class="comment">% function [amplitude] = get_single_amplitude(data, fs, s_begin, s_end, foi)</span>
<span class="comment">% takes signal data matrix, frequency, beginning index of slice, end index</span>
<span class="comment">% of slice and a frequency of interest and returns the amplitude of the</span>
<span class="comment">% frequency</span>
<span class="keyword">if</span> (s_begin &lt; 1 || s_end &gt; size(data,2))
    amplitude = NaN;
<span class="keyword">else</span>
    slice = data(:,s_begin:s_end);
    [range, amplitudes] = fourier_transform(fs, slice);
    amp_mean = mean(amplitudes);
    [~, idx] = nearest_value(range, foi);
    amplitude = amp_mean(idx);
<span class="keyword">end</span>
<span class="keyword">end</span>
</pre>

	<h1>8.6 mean amplitude </h1>

	<h2 id="1">8.6</h2><pre class="codeinput">load(<span class="string">'tfr-data.mat'</span>);
window_size = 100;
foi = 29;
fs = 1/(time(2)-time(1));
</pre><h2 id="2">8.6 - a)</h2><pre class="codeinput">amps = zeros(1,size(data,2));
</pre><h2 id="3">8.6 - b) + c)</h2><pre class="codeinput"><span class="keyword">for</span> t=1:size(data,2)
    s_begin = t-floor(window_size/2);
    s_end = t+ceil(window_size/2)-1;
    amps(t) = get_single_amplitude(data, fs, s_begin, s_end, foi);
<span class="keyword">end</span>
</pre>
	
	<h1>8.7 sliding window analysis</h1>
	<h2>get_amplitude function</h2>

	<pre class="codeinput"><span class="keyword">function</span> [amplitudes] = get_amplitude(data, fs, window_size, foi)
<span class="comment">% function [amplitudes] = get_amplitude(data, fs, window_size, foi)</span>
<span class="comment">% function takes data, sampling frequency, size of sample window and</span>
<span class="comment">% frequency of interest and returns vector of the amplitudes of that</span>
<span class="comment">% frequency for each window, having as many windows as data points per</span>
<span class="comment">% sensor in the data</span>

amplitudes = zeros(1,size(data,2));

<span class="keyword">for</span> t=1:size(data,2)
    s_begin = t-floor(window_size/2);
    s_end = t+ceil(window_size/2)-1;
    amplitudes(t) = get_single_amplitude(data, fs, s_begin, s_end, foi);
<span class="keyword">end</span>
</pre>
	
	<h2 id="1">8.7</h2><pre class="codeinput">load(<span class="string">'tfr-data.mat'</span>);
window_size = 100;
foi = 29;
fs = 1/(time(2)-time(1));
</pre><h2 id="2">8.7 a)</h2><pre class="codeinput">plot(time, get_amplitude(data, fs, window_size, foi));
xlabel(<span class="string">'Time(s)'</span>);
ylabel(<span class="string">'Amplitude'</span>);
title(<span class="string">'amplitude of the 29-Hz component over time'</span>);
set(gcf, <span class="string">'Position'</span>, [10,10,600,600]);
</pre><img vspace="5" hspace="5" src="ex8_7_01.png" alt=""> 
	
	<h1>8.8 tfr</h1>

	<h2 id="1">8.8</h2><pre class="codeinput">load(<span class="string">'tfr-data.mat'</span>);
fs = 1/(time(2)-time(1));
tfr = [];
</pre><h2 id="2">8.8 a)</h2><pre class="codeinput"><span class="keyword">for</span> freq = 1:60
    window_size = ( (1/freq)*fs) * 7;
    tfr = [tfr; get_amplitude(data, fs, window_size, freq)];
<span class="keyword">end</span>
</pre><h2 id="3">8.8 b)</h2><pre class="codeinput">image(128 + 128* tfr./max( max( abs(tfr) ) ) );
set(gca, <span class="string">'YDIR'</span>, <span class="string">'normal'</span>);
set(gca, <span class="string">'XTick'</span>, linspace(1,size(data,2), 10));
tf = time(1); tl = time(end);
set(gca, <span class="string">'XTickLabel'</span>, round(10*(linspace(tf,tl,10)))/10);
colormap <span class="string">jet</span>;
xlabel(<span class="string">'Time (s)'</span>);
ylabel(<span class="string">'Frequency (Hz)'</span>);
title(<span class="string">'Time-frequency plot'</span>);
</pre><img vspace="5" hspace="5" src="ex8_8_01.png" alt=""> 

	<h1>8.9 corrected tfr</h1>

	<h2 id="1">8.9</h2><pre class="codeinput">load(<span class="string">'tfr-data.mat'</span>);
fs = 1/(time(2)-time(1));
tfr = [];
<span class="keyword">for</span> freq = 1:60
    window_size = ( (1/freq)*fs) * 7;
    tfr = [tfr; get_amplitude(data, fs, window_size, freq)];
<span class="keyword">end</span>
</pre><h2 id="2">8.9 - a)</h2><pre class="codeinput">baseline_tfr = tfr(:,time&lt;0);
baseline_mean = nanmean(baseline_tfr,2);
tfr_corrected = tfr - repmat(baseline_mean, 1, size(tfr,2));
</pre><h2 id="3">8.9 - b)</h2><pre class="codeinput">image(128 + 128* tfr_corrected./max( max( abs(tfr_corrected) ) ) );
set(gca, <span class="string">'YDIR'</span>, <span class="string">'normal'</span>);
set(gca, <span class="string">'XTick'</span>, linspace(1,size(data,2), 10));
tf = time(1); tl = time(end);
set(gca, <span class="string">'XTickLabel'</span>, round(10*(linspace(tf,tl,10)))/10);
colormap <span class="string">jet</span>;
xlabel(<span class="string">'Time (s)'</span>);
ylabel(<span class="string">'Frequency (Hz)'</span>);
title(<span class="string">'Baseline Corrected Time-frequency plot'</span>);
</pre><img vspace="5" hspace="5" src="ex8_9_01.png" alt=""> 

	<h1>Misc: modified Fourier Transform function, similar to the one i previously forgot to submit</h1>
	<pre class="codeinput"><span class="keyword">function</span>[range, amplitude] = fourier_transform(fs, signal)
<span class="comment">% function[range, amplitude] = fourier_transform(time, signal)</span>
<span class="comment">% takes a frequency scalar and data matrix, returns the range and amplitude</span>
<span class="comment">% of the fourier transform of that signal.</span>

<span class="comment">% convert signal from time to frequency domain</span>
Y = fft(signal,[], 2);
n = size(signal, 2);

<span class="comment">% get the amplitude</span>
amplitude = abs(Y)/n;

<span class="comment">% construct the associated frequency vector:</span>
T=n/fs;
df=1/T;
f=0:df:(fs-df);

<span class="comment">% take Nyquist into account</span>
n = size(Y,2);
n_cutoff = floor(n/2);
range = f(1:n_cutoff);
amplitude = 2 * amplitude(:,1:n_cutoff);
amplitude(:,1) = amplitude(:,1)/2;
<span class="keyword">end</span>
</pre>
	</div></body></html>