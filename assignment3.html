<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html><head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
--><title>ex3_5</title><meta name="generator" content="MATLAB 9.9"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2021-02-11"><meta name="DC.source" content="ex3_5.m"><style type="text/css">
	html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1; width:95%;}}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

	html { min-height:100%; margin-bottom:1px; }
	html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
	html body td { vertical-align:top; text-align:left; }

	h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
	h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
	h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

	a { color:#005fce; text-decoration:none; }
	a:hover { color:#005fce; text-decoration:underline; }
	a:visited { color:#004aa0; text-decoration:none; }

	p { padding:0px; margin:0px 0px 20px; }
	img { padding:0px; display: block; margin: 0px auto 0px; border:none; width:90%;}
	p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

	ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
	ul li { padding:0px; margin:0px 0px 7px 0px; }
	ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
	ul li ol li { list-style:decimal; }
	ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
	ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
	ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
	ol li ol li { list-style-type:lower-alpha; }
	ol li ul { padding-top:7px; }
	ol li ul li { list-style:square; }

	.content { font-size:1.2em; line-height:140%; padding: 20px; }

	pre, code { font-size:12px; background:#f7f7f7;   }
	tt { font-size: 1.2em; }
	pre { margin:0px 0px 20px; }
	pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
	pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
	pre.error { color:red; }

	@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

	span.keyword { color:#0000FF }
	span.comment { color:#228B22 }
	span.string { color:#A020F0 }
	span.untermstring { color:#B20000 }
	span.syscmd { color:#B28C00 }
	span.typesection { color:#A0522D }

	.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
	.footer p { margin:0px; }
	.footer a { color:#878787; }
	.footer a:hover { color:#878787; text-decoration:underline; }
	.footer a:visited { color:#878787; }

	table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
	table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }



</style></head><body>



	<div class="content">

		<h1> Assignment 3 - Dimitar Dimitrov - s1018291

		<h1> 3.2 Clipping </h1>
		<pre class="codeinput">[logoff_sound,sampleRate] = audioread(<span class="string">'logoff.wav'</span>);
high = max(abs(logoff_sound), [], <span class="string">'all'</span>);
<span class="comment">%sound(logoff_sound, sampleRate);</span>
duration = (length(logoff_sound) - 1)*1/sampleRate;
t = 0:1/sampleRate: duration;

subplot(3,1,1);
plot(t, logoff_sound);
xlim([0 duration]);
ylim([-1*high high]);
title(<span class="string">'Windows "Log Off" Sound'</span>);
legend(<span class="string">'channel 1'</span>, <span class="string">'channel 2'</span>);
xlabel(<span class="string">'time (s)'</span>);
ylabel(<span class="string">'amplitude'</span>);

lowampres = round(logoff_sound * 10)/10;

subplot(3,1,2);
plot(t, lowampres);
title([{<span class="string">'Windows "Log Off" Sound'</span>},{<span class="string">'with lower amplitude resolution'</span>}]);
xlim([0 duration]);
ylim([-1*high high]);
legend(<span class="string">'channel 1'</span>, <span class="string">'channel 2'</span>);
xlabel(<span class="string">'time (s)'</span>);
ylabel(<span class="string">'amplitude'</span>);
<span class="comment">% the amplitude seems to be using only 7 values (6 steps)</span>
<span class="comment">%sound(lowampres, sampleRate);</span>
lowerampres = round(lowampres * 10)/10;
<span class="comment">%sound(lowerampres, sampleRate);</span>
<span class="comment">% during the first downscaling of the resolution the amplitudes were</span>
<span class="comment">% assigned to their closest value (and it had only 7 values) which means a</span>
<span class="comment">% lot of sounds were assigned to a value higher than their original one</span>
<span class="comment">% during the rounding. Now those already higher values are amplified again</span>
<span class="comment">% which produces an even louder soundwave (larger amplitudes).</span>

A_max = max(abs(logoff_sound), [], <span class="string">'all'</span>);
clipped_sound = logoff_sound;
clip_factor = 0.8;
clipped_sound(clipped_sound&gt; clip_factor*A_max) = clip_factor*A_max;
clipped_sound(clipped_sound&lt; -1*clip_factor*A_max) = -1*clip_factor*A_max;

subplot(3,1,3);
plot(t, clipped_sound);
title([{<span class="string">'Windows "Log Off" Sound'</span>},{<span class="string">'with 80% of max amplitude clipping'</span>}]);
xlim([0 duration]);
ylim([-1*high high]);
legend(<span class="string">'channel 1'</span>, <span class="string">'channel 2'</span>);
xlabel(<span class="string">'time (s)'</span>);
ylabel(<span class="string">'amplitude'</span>);
<span class="comment">%saveas(gcf,'windows_logoff.png');</span>
<span class="comment">%sound(clipped_sound, sampleRate);</span>

<span class="comment">% at 80% I personally can't hear the difference but plotting the sound</span>
<span class="comment">% makes it obvious that the sound never goes beyond a particular amplitude</span>

<span class="comment">% as we lower the amplitude the sound gets quiter, which makes sense since</span>
<span class="comment">% we've decreased the amplitude which is effectively the loudness</span>
</pre><img vspace="5" hspace="5" src="windows_logoff.png" alt=""> 

		<h1> 3.3 Sound </h1>
		<h2> 3.3.1 Saxophone </h2>
		<pre class="codeinput">[sax, Fs] = audioread(<span class="string">'Saxophone.wav'</span>);
<span class="comment">% the shape of sax is 70000;1 so it is a mono recording</span>
<span class="comment">% the sampling frequency is 8000hz (8khz)</span>
<span class="comment">% nyquist frequency of this clip = 8000/2 = 4000hz (4khz)</span>

<span class="comment">% sound(sax, Fs)</span>
nyq_sax = sax(1:2:length(sax));
nyq_Fs = Fs/2;
<span class="comment">% sampling frequency is now 4000hz</span>

<span class="comment">%sound(nyq_sax,nyq_Fs);</span>
<span class="comment">% the sound is muffled</span>

q_sax = sax(1:4:length(sax));
q_Fs = Fs/4;
<span class="comment">% sampling frequency is now 2000hz</span>

<span class="comment">% sound(q_sax, q_Fs);</span>
<span class="comment">% the sound is even more muffled and particular segments sound like a</span>
<span class="comment">% vibration/rattling rather than a tone</span>

section = sax(24000:25000);
section2 = nyq_sax(24000/2:25000/2);
section4 = q_sax(24000/4:25000/4);

ts = 0:1/Fs:(length(section) - 1) *1/Fs;
ts2 = 0:1/(Fs/2):(length(section2) - 1)*1/(Fs/2) ;
ts4 = 0:1/(Fs/4):(length(section4) - 1)*1/(Fs/4) ;

high = max(abs(section));
high2 = max(abs(section2));
high4 = max(abs(section4));

subplot(3,1,1);
plot(ts, section);
title(<span class="string">'normal saxophone'</span>);
xlim([0 ts(end)]);
xlabel(<span class="string">'time (s)'</span>);
ylabel(<span class="string">'amplitude'</span>);
ylim([-1*high high]);

subplot(3,1,2);
plot(ts2, section2);
title(<span class="string">'resampled sax factor 2'</span>);
xlim([0 ts2(end)]);
xlabel(<span class="string">'time (s)'</span>);
ylabel(<span class="string">'amplitude'</span>);
ylim([-1*high2 high2]);

subplot(3,1,3);
plot(ts4, section4);
title(<span class="string">'resampled sax factor 4'</span>);
xlim([0 ts4(end)]);
xlabel(<span class="string">'time (s)'</span>);
ylabel(<span class="string">'amplitude'</span>);
ylim([-1*high4 high4]);

<span class="comment">saveas(gcf, 'sax_comparison.png'); </span>

<span class="comment">% we can see that with quarter the original sampling rate a sinusoid is</span>
<span class="comment">% starting to form where there wasn't one before, which is a sign of</span>
<span class="comment">% aliasing taking place</span>

[newS,newFs] = downsampleSound(sax,Fs,7);
<span class="comment">% sound(newS, newFs);</span>
<span class="comment">% with factor 7 it's already hard to tell, with factor 8 it could be</span>
<span class="comment">% anything</span>
</pre><img vspace="5" hspace="5" src="sax_comparison.png" alt="Saxophone Comparison">

<h2> 3.3.2 Downsample Sound </h2>
<pre class="codeinput"><span class="keyword">function</span> [newSound, newFs] = downsampleSound(soundMatrix, sampleRate, downsampleFactor)
<span class="comment">% function [new_sound, newFs] = downsampleSound(soundMatrix, sampleRate, downsampleFactor)</span>
<span class="comment">% downsamples a sound according to a given factor</span>
<span class="comment">% takes a:</span>
<span class="comment">% soundMatrix - matrix of samples comprising the sound</span>
<span class="comment">% sampleRate - the sample rate of that matrix (integer, samples per second)</span>
<span class="comment">% resampleFactor - factor by which the sampling will be divided/degraded</span>
<span class="comment">% and returns:</span>
<span class="comment">% newSound - the resampled versions of the sound matrix</span>
<span class="comment">% newFS - the new sampling rate (integer, samples per second)</span>
<span class="comment">% downSampe(A,B,2) returns newSound, a sound matrix that has half the samples</span>
<span class="comment">% of A and newFs, the new sampling rate, equal to B/2.</span>

newSound = soundMatrix(1:downsampleFactor:length(soundMatrix));
newFs = round(sampleRate/downsampleFactor);
</pre>
		<h1> 3.5 EEG data </h1>
		<pre class="codeinput">load(<span class="string">'EEGdata.mat'</span>);
plot(t, EEGdata);
xlim([t(1) t(end)]);
<span class="comment">% there should be an amplitude spike shortly after a stimulus</span>
ind_event = find(event==1); 
<span class="comment">% ind_event has length 200 so the stimulus was presented 200 times</span>
between = diff(ind_event);
<span class="comment">% there's different amount of samples between events</span>
min_samples = min(between);
<span class="comment">% the minimum amount of samples between 2 consecutive events is 292</span>
EEGsorted= [];
<span class="keyword">for</span> i=1:200
	v = EEGdata(ind_event(i):ind_event(i)+min_samples);
	EEGsorted = [EEGsorted v];
<span class="keyword">end</span>
EEGmean = mean(EEGsorted, 2);
sampleLength = mean(diff(t)); <span class="comment">% get the average temporal difference between samples</span>
time = 0:sampleLength:sampleLength*(min_samples);
plot(time,EEGmean)
title(<span class="string">'mean EEG signal accross 200 trials'</span>)
xlabel(<span class="string">'time (s)'</span>);
xlim([time(1) time(end)]);
ylim([min(EEGmean) max(EEGmean)]);
ylabel(<span class="string">'amplitude (v)'</span>);
<span class="comment">%saveas(gcf, 'mean_eeg_time.png');</span>

<span class="comment">% we can see a positive ERP right before the 50th sample, followed by a</span>
<span class="comment">% negative potential at around the 80th sample, and another positive</span>
<span class="comment">% potential at around 130th sample.</span>
<span class="comment">% after looking at the t vector it seems it's sampling once every 0.0042</span>
<span class="comment">% seconds, so after converting to that timeline it seems that the potentials</span>
<span class="comment">% occur at respectively ~200ms, ~350-400ms and ~550ms which are likely</span>
<span class="comment">% components P200 (aka P2), N400 and P600</span>
<span class="comment">% the latter two are associated with grammatical error/unexpected words</span>
<span class="comment">% if I recall correctly</span>
</pre>

<img vspace="5" hspace="5" src="mean_eeg_time.png" alt="Mean EEG Signal">



 </body></html>